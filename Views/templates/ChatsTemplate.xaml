<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:talk2.Views">

    <Style x:Key="ChatStyle" TargetType="TextBox">
        <Setter Property="Background" Value="Transparent"/>
        <Setter Property="BorderThickness" Value="0"/>
        <Setter Property="IsReadOnly" Value="True"/>
        <Setter Property="TextWrapping" Value="Wrap"/>
        <Setter Property="MaxWidth" Value="200"/>
        <Setter Property="Foreground" Value="Black"/>
        <!--<Setter Property="Focusable" Value="False"/>-->
        <!--<Setter Property="Padding" Value="0"/>-->
        <!--<Setter Property="Margin" Value="0"/>-->
    </Style>
    
    <!-- 상대방 메시지 템플릿 -->
    <DataTemplate x:Key="OtherMessageTemplate">
        <StackPanel>
            <StackPanel Orientation="Horizontal" Margin="0,0,4,4">
                <Border Width="40" Height="40"
                    CornerRadius="20"
                    Background="White"
                    ClipToBounds="True"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center">
                    <Border.Clip>
                        <EllipseGeometry Center="20,20" RadiusX="20" RadiusY="20"/>
                    </Border.Clip>
                    <Image Source="{Binding ProfileImage}"
                        Stretch="UniformToFill"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"/>
                </Border>
                <StackPanel>
                    <TextBlock Text="{Binding UsrNm}"
                        FontWeight="Bold"
                        Foreground="Gray"
                        Margin="0,0,0,2"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Border Grid.Column="0"
                            Background="#FFE0E0E0"
                            CornerRadius="10"
                            Padding="10"
                            MaxWidth="170">
                            <TextBox Text="{Binding chat}" Style="{StaticResource ChatStyle}" AutomationProperties.AutomationId="chat"/>
                        </Border>
                        <Button Grid.Column="1" Content="저장" HorizontalAlignment="Left" MaxWidth="160" Background="AntiqueWhite" BorderBrush="White" Padding="5,5,5,5" Visibility="{Binding isFile}" Command="{Binding DataContext.DownloadCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" >
                            <Button.CommandParameter>
                                <Binding Path="." />
                            </Button.CommandParameter>
                        </Button>
                        <TextBlock Grid.Column="2" Text="{Binding Layout_Date}" FontSize="10" Foreground="LightGray" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="3,0,0,0"/>
                    </Grid>
                </StackPanel>
            </StackPanel>
            <StackPanel>
                <Image Source="{Binding Image}" HorizontalAlignment="Left" Visibility="{Binding isImage}" MaxWidth="160">
                    <Image.InputBindings>
                        <MouseBinding MouseAction="LeftClick"
                        Command="{Binding DataContext.ImageViewCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                        CommandParameter="{Binding Image}" />
                    </Image.InputBindings>
                </Image>
            </StackPanel>
        </StackPanel>
    </DataTemplate>

    <!-- 내 메시지 템플릿 -->
    <DataTemplate x:Key="MyMessageTemplate">
        <StackPanel>
            <StackPanel Orientation="Horizontal"
                HorizontalAlignment="Right"
                Margin="0,0,4,4">
                <TextBlock Text="{Binding Layout_Date}" FontSize="10" Foreground="LightGray" HorizontalAlignment="Right" VerticalAlignment="Bottom" Margin="0,0,3,0"/>
                <Border Background="#FFDCF8C6"
                    CornerRadius="10"
                    Padding="10"
                    MaxWidth="170">
                    <TextBox Text="{Binding chat}" Style="{StaticResource ChatStyle}" AutomationProperties.AutomationId="chat"/>
                </Border>
                <Button Content="저장" HorizontalAlignment="Right" MaxWidth="160" Background="AntiqueWhite" BorderBrush="White" Padding="5,5,5,5" Visibility="{Binding isFile}" Command="{Binding DataContext.DownloadCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}" >
                    <Button.CommandParameter>
                        <Binding Path="." />
                    </Button.CommandParameter>
                </Button>
            </StackPanel>
            <StackPanel>
                <Image Source="{Binding Image}" HorizontalAlignment="Right" Visibility="{Binding isImage}" MaxWidth="160">
                    <Image.InputBindings>
                        <MouseBinding MouseAction="LeftClick"
                            Command="{Binding DataContext.ImageViewCommand, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"
                            CommandParameter="{Binding Image}" />
                    </Image.InputBindings>
                </Image>
            </StackPanel>
        </StackPanel>
    </DataTemplate>

    <!-- 공지 메시지 템플릿 -->
    <DataTemplate x:Key="NoticeMessageTemplate">
        <StackPanel>
            <StackPanel Orientation="Horizontal"
                HorizontalAlignment="Center"
                Margin="0,0,4,4">
                <Border Background="#FFD0EBFF"
                    CornerRadius="10"
                    Padding="10"
                    MaxWidth="200">
                    <TextBox Text="{Binding chat}" Style="{StaticResource ChatStyle}" AutomationProperties.AutomationId="chat"/>
                </Border>
                <TextBlock Text="{Binding Layout_Date}" FontSize="10" Foreground="LightGray" HorizontalAlignment="Left" VerticalAlignment="Bottom" Margin="3,0,0,0"/>
            </StackPanel>
        </StackPanel>
    </DataTemplate>

    <!-- 템플릿 선택자 -->
    <local:ChatMessageTemplateSelector x:Key="MessageTemplateSelector"
                                       MyMessageTemplate="{StaticResource MyMessageTemplate}"
                                       OtherMessageTemplate="{StaticResource OtherMessageTemplate}"
                                       NoticeMessageTemplate="{StaticResource NoticeMessageTemplate}" />
</ResourceDictionary>